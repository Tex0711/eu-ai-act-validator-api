---
import Layout from '../layouts/Layout.astro';

const codeProxy = `# Nginx: location voor AI-verkeer
location /v1/chat/completions {
  auth_request /compliance-check;
  proxy_pass https://api.openai.com;
}
location = /compliance-check {
  internal;
  proxy_pass https://your-app.com/api/v1/gatekeeper;
  proxy_pass_request_body on;
  proxy_set_header x-api-key $api_key;
}`;

const codeGateway = `plugins:
  - name: http-request
    config:
      method: POST
      url: https://your-app.com/api/v1/gatekeeper
      headers: { x-api-key: $(env.API_KEY) }
      body: '{"prompt": "$(request.body.prompt)"}'`;
---

<Layout title="EU AI Act Compliance API">
  <div class="bg-navy min-h-screen">
    <main class="container mx-auto px-4 py-12 max-w-5xl">
      <!-- Hero -->
      <section class="text-center mb-20">
        <span class="inline-block px-3 py-1 text-xs font-semibold text-electric bg-electric/10 border border-electric/30 rounded-full mb-6">Beta – Early Access</span>
        <h1 class="text-4xl sm:text-5xl font-bold text-slate-light mb-4">
          Real-time AI Governance in <span class="text-electric">&lt;50ms</span>
        </h1>
        <p class="text-xl text-slate max-w-2xl mx-auto mb-10">
          De enige stateless Legal Guardrail API die de EU AI Act handhaaft zonder je applicatie te vertragen. Gebouwd in Rust voor missiekritische snelheid.
        </p>
        <a
          href="/pioneer"
          class="inline-flex items-center px-6 py-3 border border-electric text-base font-medium rounded-md text-navy bg-electric hover:bg-electric-dim hover:border-electric-dim text-navy transition duration-0 shadow-glow"
        >
          Join the Beta Pioneer Program
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </a>
      </section>

      <!-- Article 5 Playground (V1) -->
      <section class="mb-20">
        <div class="bg-navy-light border border-electric/20 rounded-xl p-6 shadow-glow">
          <h2 class="text-2xl font-bold text-slate-light mb-2">Test your prompt for Article 5 violations</h2>
          <p class="text-slate text-sm mb-4">Enter a system prompt or user query. Mock result reflects fast-path (&lt;50ms) legal reference.</p>
          <div class="flex flex-col sm:flex-row gap-4 mb-4">
            <input
              type="text"
              id="playground-input"
              placeholder="Enter a system prompt or user query"
              class="flex-1 rounded-lg border border-electric/30 bg-navy text-slate-light px-4 py-3 placeholder-slate-dark focus:outline-none focus:ring-2 focus:ring-electric/50 focus:border-electric transition duration-0"
            />
            <button
              type="button"
              id="playground-submit"
              class="px-6 py-3 rounded-lg bg-electric text-navy font-medium hover:bg-electric-dim border border-electric transition duration-0"
            >
              Check
            </button>
          </div>
          <div id="playground-result" class="hidden rounded-lg border p-4 font-mono text-sm">
            <div id="playground-result-label" class="font-semibold mb-1"></div>
            <div id="playground-result-detail" class="text-slate"></div>
            <div id="playground-result-ms" class="text-electric text-xs mt-2"></div>
          </div>
        </div>
      </section>

      <!-- Choose your perspective: Three Paths -->
      <section class="mb-20">
        <h2 class="text-2xl font-bold text-slate-light mb-2 text-center">Choose your perspective</h2>
        <p class="text-slate text-center mb-10">DPO, CISO, or Developer — one API, three stakeholder views.</p>
        <div class="grid sm:grid-cols-3 gap-6">
          <div class="bg-navy-light border border-electric/20 rounded-xl p-6 hover:shadow-glow transition duration-0">
            <div class="flex items-center gap-2 mb-4">
              <svg class="w-8 h-8 text-electric" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <h3 class="text-lg font-bold text-electric">DPO</h3>
            </div>
            <p class="text-slate-dark text-sm font-medium mb-1">Problem</p>
            <p class="text-slate text-sm mb-3">Geen zicht op welke prompts naar AI gaan; audit-trail ontbreekt voor toezichthouder.</p>
            <p class="text-slate-dark text-sm font-medium mb-1">Sovereign solution</p>
            <p class="text-slate text-sm">Audit-Ready Logs (Art. 12): onwijzigbare logs met gemaskeerde prompt + beslissing. Data minimalisatie door PII-stripping.</p>
          </div>
          <div class="bg-navy-light border border-electric/20 rounded-xl p-6 hover:shadow-glow transition duration-0">
            <h3 class="text-lg font-bold text-electric mb-4">CISO</h3>
            <p class="text-slate-dark text-sm font-medium mb-1">Problem</p>
            <p class="text-slate text-sm mb-3">US CLOUD Act-risico; data in niet-EU cloud; geen controle over AI-verkeer.</p>
            <p class="text-slate-dark text-sm font-medium mb-1">Sovereign solution</p>
            <p class="text-slate text-sm">EU-Sovereignty: 100% EU-hosted (Scaleway/OVH). &lt;1ms local latency voor Fast Path. Stateless: wij slaan geen prompts op.</p>
          </div>
          <div class="bg-navy-light border border-electric/20 rounded-xl p-6 hover:shadow-glow transition duration-0">
            <h3 class="text-lg font-bold text-electric mb-4">Developer</h3>
            <p class="text-slate-dark text-sm font-medium mb-1">Problem</p>
            <p class="text-slate text-sm mb-3">Compliance inbouwen vertraagt releases; geen eenvoudige API voor EU AI Act.</p>
            <p class="text-slate-dark text-sm font-medium mb-1">Sovereign solution</p>
            <p class="text-slate text-sm mb-3">Eén endpoint: POST prompt → ALLOW/DENY/WARNING + reden + artikel. Proxy, SDK of Gateway — drie regels code.</p>
            <pre class="bg-navy rounded p-3 text-electric/90 text-xs overflow-x-auto border border-electric/20"><code>guardrail.check(prompt)
if response["decision"] == "DENY": reject()</code></pre>
          </div>
        </div>
      </section>

      <!-- Value Proposition Matrix -->
      <section class="mb-20">
        <h2 class="text-2xl font-bold text-slate-light mb-6 text-center">How ComplianceCode aligns your stakeholders</h2>
        <div class="overflow-x-auto rounded-xl border border-electric/20 shadow-glow">
          <table class="min-w-full">
            <thead class="bg-navy-light">
              <tr>
                <th class="text-left px-4 py-3 text-sm font-semibold text-electric">Stakeholder</th>
                <th class="text-left px-4 py-3 text-sm font-semibold text-electric">Pain point</th>
                <th class="text-left px-4 py-3 text-sm font-semibold text-electric">Sovereign solution</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-electric/10">
              <tr class="bg-navy-light/50"><td class="px-4 py-3 text-sm font-medium text-slate-light">DPO</td><td class="px-4 py-3 text-sm text-slate">Geen audit-trail; geen inzicht in AI-prompts; GDPR-risico.</td><td class="px-4 py-3 text-sm text-slate">Audit-Ready Logs (Art. 12), PII-stripping, gemaskeerde prompt in log.</td></tr>
              <tr class="bg-navy-light/50"><td class="px-4 py-3 text-sm font-medium text-slate-light">CISO</td><td class="px-4 py-3 text-sm text-slate">CLOUD Act; data buiten EU; latency en beschikbaarheid.</td><td class="px-4 py-3 text-sm text-slate">100% EU-hosted, stateless, &lt;50ms Fast Path, rate limiting.</td></tr>
              <tr class="bg-navy-light/50"><td class="px-4 py-3 text-sm font-medium text-slate-light">Developer</td><td class="px-4 py-3 text-sm text-slate">Compliance vertraagt; geen simpele API voor EU AI Act.</td><td class="px-4 py-3 text-sm text-slate">Eén API, proxy/SDK/Gateway, drie regels code, &lt;50ms waar mogelijk.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Integration Tabs -->
      <section class="mb-20">
        <h2 class="text-2xl font-bold text-slate-light mb-4">Integreer in drie stappen</h2>
        <p class="text-slate mb-6">Kies proxy, SDK of API Gateway.</p>
        <div class="bg-navy-light border border-electric/20 rounded-xl overflow-hidden shadow-glow">
          <div class="flex border-b border-electric/20 bg-navy" role="tablist" id="integration-tabs">
            <button type="button" class="integration-tab px-6 py-3 text-sm font-medium border-b-2 border-electric text-electric -mb-px transition duration-0" data-tab="proxy" aria-selected="true">Proxy (Nginx)</button>
            <button type="button" class="integration-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-slate hover:text-electric transition duration-0" data-tab="sdk" aria-selected="false">SDK (3 regels)</button>
            <button type="button" class="integration-tab px-6 py-3 text-sm font-medium border-b-2 border-transparent text-slate hover:text-electric transition duration-0" data-tab="gateway" aria-selected="false">API Gateway (Kong)</button>
          </div>
          <div class="p-6">
            <div id="tab-proxy" class="tab-panel" role="tabpanel">
              <p class="text-sm text-slate mb-3">Verkeer naar OpenAI omleiden via je proxy; de proxy roept ComplianceCode aan vóór doorsturen.</p>
              <pre class="bg-navy text-electric/90 p-4 rounded-lg overflow-x-auto text-sm border border-electric/20"><code>{codeProxy}</code></pre>
            </div>
            <div id="tab-sdk" class="tab-panel hidden" role="tabpanel">
              <p class="text-sm text-slate mb-3">Three-line install: wrap je prompt in een guardrail-call.</p>
              <pre class="bg-navy text-electric/90 p-4 rounded-lg overflow-x-auto text-sm border border-electric/20"><code>from compliancecode import guardrail
response = guardrail.check(prompt, api_key=os.environ["API_KEY"])
if response["decision"] == "DENY": raise ValueError(response["reason"])</code></pre>
            </div>
            <div id="tab-gateway" class="tab-panel hidden" role="tabpanel">
              <p class="text-sm text-slate mb-3">Kong-plugin: request eerst door ComplianceCode laten valideren.</p>
              <pre class="bg-navy text-electric/90 p-4 rounded-lg overflow-x-auto text-sm border border-electric/20"><code>{codeGateway}</code></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- Sovereignty & Trust -->
      <section class="mb-20">
        <h2 class="text-2xl font-bold text-slate-light mb-6">Sovereignty &amp; Trust</h2>
        <div class="grid sm:grid-cols-3 gap-6">
          <div class="bg-navy-light border border-electric/20 rounded-xl p-6 hover:shadow-glow transition duration-0">
            <div class="text-lg font-bold text-electric mb-2">100% EU-Hosted</div>
            <p class="text-slate text-sm">Data verlaat nooit de Europese jurisdictie (Scaleway/OVH). Geen CLOUD Act-exposure.</p>
          </div>
          <div class="bg-navy-light border border-electric/20 rounded-xl p-6 hover:shadow-glow transition duration-0">
            <div class="text-lg font-bold text-electric mb-2">Stateless by Design</div>
            <p class="text-slate text-sm">Wij slaan geen prompts op. Wat we niet hebben, kunnen we niet lekken. Alleen audit-log op jouw verzoek.</p>
          </div>
          <div class="bg-navy-light border border-electric/20 rounded-xl p-6 hover:shadow-glow transition duration-0">
            <div class="text-lg font-bold text-electric mb-2">Audit-Ready (Art. 12)</div>
            <p class="text-slate text-sm">Onwijzigbare logs voor je volgende toezichthouder-audit. Input → Redenering → Output.</p>
          </div>
        </div>
      </section>

      <!-- CTA + Beta disclaimer -->
      <section class="text-center mb-12">
        <a href="/pioneer" class="inline-flex items-center px-6 py-3 border border-electric text-base font-medium rounded-md text-navy bg-electric hover:bg-electric-dim transition duration-0 shadow-glow">
          Join the Beta Pioneer Program
        </a>
        <p class="mt-6 text-sm text-amber-200 bg-amber-900/30 border border-amber-500/30 rounded-lg px-4 py-3 max-w-2xl mx-auto">
          <strong>Beta – inspanningsverplichting:</strong> De API wordt aangeboden op basis van best effort; geen resultaatgarantie. Geschikt voor early adopters en pilots.
        </p>
      </section>
    </main>
  </div>
</Layout>

<script>
  document.querySelectorAll('.integration-tab').forEach((btn) => {
    btn.addEventListener('click', () => {
      const tab = btn.getAttribute('data-tab');
      document.querySelectorAll('.integration-tab').forEach((b) => {
        b.classList.remove('border-electric', 'text-electric');
        b.classList.add('border-transparent', 'text-slate');
        b.setAttribute('aria-selected', 'false');
      });
      btn.classList.add('border-electric', 'text-electric');
      btn.classList.remove('border-transparent', 'text-slate');
      btn.setAttribute('aria-selected', 'true');
      document.querySelectorAll('.tab-panel').forEach((panel) => {
        panel.classList.add('hidden');
        if (panel.id === `tab-${tab}`) panel.classList.remove('hidden');
      });
    });
  });

  /** Mock Article 5 matcher: returns first matching rule (NL + EN keywords). */
  function mockArticle5Match(prompt) {
    const t = (prompt || '').toLowerCase();
    // Art. 5(1)(a) – subliminal / behavioural manipulation
    if (/\b(subliminal|onwaarneembare?|gedragsmanipulatie|zonder dat ze het doorhebben|visuele signalen.*stimuleren|stimuleren.*zonder)\b/.test(t) ||
        /\b(subliminal|imperceptible|behavioural manipulation|without (their )?awareness)\b/.test(t))
      return { decision: 'REJECTED', article: 'Art. 5(1)(a)', reason: 'Subliminal manipulation / behavioural manipulation beyond awareness' };
    // Art. 5(1)(b) – exploitation of vulnerability (age, disability, etc.)
    if (/\b(exploitatie|kwetsbaar|eenzame ouderen|dementie|spaargeld.*investeren|investeren.*spaargeld|overtuigen.*investeren)\b/.test(t) ||
        /\b(exploit|vulnerable|elderly|dementia|lonely.*invest|convince.*invest|savings.*crypto)\b/.test(t))
      return { decision: 'REJECTED', article: 'Art. 5(1)(b)', reason: 'Exploitation of vulnerabilities (e.g. age, mental impairment)' };
    // Art. 5(1)(c) – social scoring
    if (/\b(betrouwbaarheidsscore|sociale score|social scoring|score.*berekenen.*burgers|posts.*sociale media.*score)\b/.test(t) ||
        /\b(social score|reliability score|trust score|citizens?.*score|social media.*score)\b/.test(t))
      return { decision: 'REJECTED', article: 'Art. 5(1)(c)', reason: 'Social scoring for general purpose' };
    // Art. 5(1)(d) – predictive policing / crime risk
    if (/\b(voorspellend.*misdaad|predictive.*policing|crime risk|recidive.*risico)\b/.test(t))
      return { decision: 'REJECTED', article: 'Art. 5(1)(d)', reason: 'Predictive crime risk assessment' };
    // Art. 5(1)(f) – emotion recognition in workplace/education
    if (/\b(emotie.*herkennen|emotion recognition|werkvloer|onderwijs.*emotie)\b/.test(t))
      return { decision: 'REJECTED', article: 'Art. 5(1)(f)', reason: 'Emotion recognition in workplace/education' };
    return { decision: 'ALLOWED', article: null, reason: 'No prohibited or high-risk provisions identified' };
  }

  document.getElementById('playground-submit')?.addEventListener('click', () => {
    const input = document.getElementById('playground-input');
    const resultEl = document.getElementById('playground-result');
    const labelEl = document.getElementById('playground-result-label');
    const detailEl = document.getElementById('playground-result-detail');
    const msEl = document.getElementById('playground-result-ms');
    if (!resultEl || !labelEl || !detailEl || !msEl) return;
    const r = mockArticle5Match(input?.value || '');
    resultEl.classList.remove('hidden');
    if (r.decision === 'REJECTED') {
      labelEl.textContent = `${r.decision}: Violates ${r.article} - ${r.reason}`;
      labelEl.className = 'font-semibold mb-1 text-red-400';
      detailEl.textContent = `Prohibited practice under ${r.article} of the EU AI Act. Request denied.`;
    } else {
      labelEl.textContent = r.decision;
      labelEl.className = 'font-semibold mb-1 text-electric';
      detailEl.textContent = r.reason + '.';
    }
    const ms = Math.floor(Math.random() * 25) + 18;
    msEl.textContent = `Fast-path result in ${ms}ms`;
  });
</script>
